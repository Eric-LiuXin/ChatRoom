<!doctype html>
{% load static %}
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href='{% static "css/bootstrap.min.css"%}'>
    <link rel="stylesheet" href='{% static "css/font-awesome.min.css"%}'>
    <link rel="stylesheet" href='{% static "css/style.css"%}'>
    <link rel="stylesheet" href='{% static "css/cropper.min.css"%}'>
    <link rel="stylesheet" href='{% static "css/img_cropper.css"%}'>
    <link rel="stylesheet" href='{% static "css/snow.css"%}'>
    <script type="text/javascript" src='{% static "js/jquery-3.3.1.min.js" %}'></script>
    <script type="text/javascript" src='{% static "js/bootstrap.min.js" %}'></script>
    <script type="text/javascript" src='{% static "ueditor/ueditor.config.js" %}'></script>
    <script type="text/javascript" src='{% static "ueditor/ueditor.all.min.js" %}'></script>
    <title>ChatRoom</title>
</head>

<body>
    <div class="snow-container">
		<div class="snow foreground"></div>
		<div class="snow foreground layered"></div>
		<div class="snow middleground"></div>
		<div class="snow middleground layered"></div>
		<div class="snow background"></div>
		<div class="snow background layered"></div>
	</div>
    <div class="container-fluid">
        <div class="nav-bar bg-white" role="tablist">
            <a id="replaceImg" class="self_avatar" href="#">
                <img src='{% get_media_prefix %}{{ user.avatar }}' id="finalImg" class="rounded-circle" style="width:100%" >
            </a>
            <div style="display: none" class="tailoring-container">
                <div class="black-cloth" onClick="closeTailor(this)"></div>
                <div class="tailoring-content">
                    <div class="tailoring-content-one">
                        <label title="上传图片" for="chooseImg" class="l-btn choose-btn">
                            <input type="file" accept="image/jpg,image/jpeg,image/png" name="file" id="chooseImg" class="hidden" onChange="selectImg(this)">
                            选择图片
                        </label>
                        <div class="close-tailoring"  onclick="closeTailor(this)">×</div>
                        <p id="message" style="line-height:32px"></p>
                    </div>
                    <div class="tailoring-content-two">
                        <div class="tailoring-box-parcel">
                            <img id="tailoringImg">
                        </div>
                        <div class="preview-box-parcel">
                            <p>图片预览：</p>
                            <div class="square previewImg"></div>
                            <div class="circular previewImg"></div>
                        </div>
                    </div>
                    <div class="tailoring-content-three">
                        <button class="l-btn cropper-reset-btn">复位</button>
                        <button class="l-btn cropper-rotate-btn">旋转</button>
                        <button class="l-btn cropper-scaleX-btn">换向</button>
                        <button class="l-btn sureCut" id="sureCut">保存</button>
                    </div>
                </div>
            </div>
            <div class="nav-bar-list nav flex-column shadow" role="tablist">
                <a class="nav-link active" data-toggle="pill" href="#v-pills-comment" role="tab" aria-controls="v-pills-comment" aria-selected="true">
                    <i class="fa fa-comment-o fa-2x fa-camera-retro" aria-hidden="true"></i>
                </a>
                <a class="nav-link" data-toggle="pill" href="#v-pills-friend" role="tab" aria-controls="v-pills-friend" aria-selected="false">
                    <i class="fa fa-user-o fa-2x" aria-hidden="true"></i>
                </a>
                <a class="nav-link" data-toggle="pill" href="#v-pills-star" role="tab" aria-controls="v-pills-star" aria-selected="false">
                    <i class="fa fa-star-o fa-2x" aria-hidden="true"></i>
                </a>
                <a class="sys-link nav-link" href="{% url 'user:logout'%}">
                    <i class="fa fa-sign-out fa-2x fa-rotate-180" aria-hidden="true"></i>
                </a>
            </div>
        </div>

        <div class="sidebar-group  tab-content bg-white shadow" id="v-pills-tabContent">
            <div class="tab-pane fade show active list-group list-group-flush" id="v-pills-comment"  aria-labelledby="v-pills-comment-tab">
                {% for friend in friend_list %}
                <a class="tab-friend list-group-item list-group-item-action" data-toggle="list" href="" onclick="join_room({{ friend.id }});return false;">
                    <div class="tab-friend-avatar">
                        <img src='{% get_media_prefix %}{{ friend.avatar }}' class="rounded-circle" alt="Cinque Terre" style="width:100%" >
                    </div>
                    <div class="tab-friend-info align-items-center">
                        <div>
                            <h6 class="mb-0 lh-100 mt-0">{{ friend.nickname }}</h6>
                            <small>Since 2011</small>
                        </div>
                    </div>
                </a>
                {% endfor %}
            </div>
            <div class="tab-pane fade show list-group" id="v-pills-friend" aria-labelledby="v-pills-friend-tab">
                <a class="list-group-item list-group-item-action" data-toggle="list" href="#">Home</a>
                <a class="list-group-item list-group-item-action"  data-toggle="list" href="#">Profile</a>
                <a class="list-group-item list-group-item-action" data-toggle="list" href="#">Messages</a>
                <a class="list-group-item list-group-item-action" data-toggle="list" href="#">Settings</a>
            </div>
            <div class="tab-pane fade show list-group" id="v-pills-star" aria-labelledby="v-pills-star-tab">
                <a class="list-group-item list-group-item-action" data-toggle="list" href="#">Home</a>
                <a class="list-group-item list-group-item-action"  data-toggle="list" href="#">Profile</a>
                <a class="list-group-item list-group-item-action" data-toggle="list" href="#">Messages</a>
                <a class="list-group-item list-group-item-action" data-toggle="list" href="#">Settings</a>
            </div>
        </div>
        <div class="chat " id="chat_room">

        </div>
    </div>
<script type="text/javascript" src='{% static "js/cropper.min.js" %}'></script>
<script type="text/javascript" src='{% static "js/ajax_csrf_token.js" %}'></script>
<script type="text/javascript" src='{% static "js/img_cropper.js" %}'></script>
<script type="text/javascript">
function join_room(friend_id){
    $.ajax({
        url: "/room/get_score/",
        type: "GET",
        data: {
            score_id: score_id,
        },
        success: function (data) {
            data = JSON.parse(data);
            if (data["success"]){
                if(!isEmpty(data['sys_score'])){
                    var html = '<label>系统打分</label><input type="number" class="form-control" value="';
                    html += data['sys_score'];
                    html += '" disabled>';
                    document.getElementById('fix_sys_score').innerHTML = html;
                }
                if (data['display_reason']){
                    html = '<label>修改原因</label><select class="form-control" id="fix_score_reason" name="fix_score_reason"><option value="">选择修改原因</option>';
                    for(index in data['fix_reason_list']){
                        html += '<option value="';
                        html += data['fix_reason_list']['index']['id'];
                        html += '">';
                        html += data['fix_reason_list']['index']['name'];
                        html += '</option>';
                    }
                    html += '</select>';
                    document.getElementById('display_reason').innerHTML = html;
                    document.getElementById('fix_score_reason').value=data['fix_reason'];
                }

                if (data['value_type'] == 'select'){
                    var html = '<label>修改打分</label><select class="form-control" name="fix_score_number" id="fix_score_number">';

                    for(option_value in data['list']){
                        html += '<option value="' + data['list'][option_value] +'">';
                        html += data['list'][option_value];
                        html += '</option>';
                    }
                    html += '</select>';
                    if(!isEmpty(data['criteria_assessment_list'])){
                        html += '<div class="alert alert-info mt-3" role="alert">';
                        for(index in data['criteria_assessment_list']){
                            html += data['criteria_assessment_list'][index];
                            html += '<br>'
                        }
                        html += '</div>';
                    };
                    document.getElementById('fix_manual_score').innerHTML = html;
                }else{
                    html = '<label>修改打分</label><input type="number" name="fix_score_number" id="fix_score_number" class="form-control" value="">';
                    if(!isEmpty(data['criteria_assessment_list'])){
                        html += '<div class="alert alert-info mt-3" role="alert">';
                        for(index in data['criteria_assessment_list']){
                            html += data['criteria_assessment_list'][index];
                            html += '<br>'
                        }
                        html += '</div>';
                    };
                    document.getElementById('fix_manual_score').innerHTML = html;
                }
                document.getElementById('fix_score_number').value=data['manual_score'];
                $('#fixScoreModal').modal("show");
            }
        },
    });
};
</script>
</body>

</html>